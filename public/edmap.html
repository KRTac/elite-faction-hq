<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <title>3d Map</title>
  <style type="text/css">
  #hud {
    overflow-y: scroll;
  }

  #json_data {
    display: none;
  }

  #edmap {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    height: 100%;
  }
  </style>

</head>

  <body>

    <div id="edmap"></div>

  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r75/three.min.js"></script>

  <div id="json_data"></div>

  <link href="/ed3d/css/styles.css" rel="stylesheet" type="text/css" />
  <script src="/ed3d/js/ed3dmap.min.js?v=5"></script>
  <script type="text/javascript">
    let mapInitialized = false;

    window.addEventListener('message', ev => {
      if (ev.data.type === 'update') {
        document.getElementById('json_data').innerText = JSON.stringify(ev.data.mapData);

        if (mapInitialized) {
          Ed3d.rebuild();

          return;
        }

        Ed3d.init({
          container: 'edmap',
          jsonContainer: 'json_data',
          basePath: '/ed3d/',
          effectScaleSystem: [ 10, 1500 ],
          startAnim: false,
          withHudPanel: true,
          withOptionsPanel: true,
          hudMultipleSelect: true,
          popupDetail: true,
          showGalaxyInfos: false,
          showNameNear: false
        });

        mapInitialized = true;

        return;
      }

      if (ev.data.type === 'debug') {
        console.log('Map debug');
      }
    });
  </script>

</body>
</html>